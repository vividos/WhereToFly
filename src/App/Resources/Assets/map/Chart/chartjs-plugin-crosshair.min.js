/*!
 * chartjs-plugin-crosshair v1.1.6
 * https://chartjs-plugin-crosshair.netlify.com
 * (c) 2021 Chart.js Contributors
 * Released under the MIT license
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("chart.js"),require("chart.js/helpers")):"function"==typeof define&&define.amd?define(["chart.js","chart.js/helpers"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Chart,t.Helpers)}(this,(function(t,e){"use strict";function a(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=a(t),r=a(e);!function(t){t.Interaction.modes.interpolate=function(e,a,i){for(var r=[],o=0;o<e.data.datasets.length;o++)if(e.data.datasets[o].interpolate){var n=e.getDatasetMeta(o);if(!n.hidden){var s=e.scales[n.xAxisID],c=e.scales[n.yAxisID],l=s.getValueForPixel(a.event.x),h=e.data.datasets[o].data,d=h.findIndex((function(t){return t.x>=l}));if(-1!==d){var u=h[d-1],g=h[d];if(u&&g)var f=(g.y-u.y)/(g.x-u.x),p=u.y+(l-u.x)*f;if(e.data.datasets[o].steppedLine&&u&&(p=u.y),!isNaN(p)){var x=c.getPixelForValue(p);if(!isNaN(x)){var m={value:p,xValue:l,tooltipPosition:function(){return this._model},hasValue:function(){return!0},_model:{x:a.event.x,y:x},_datasetIndex:o,_index:r.length,_xScale:{getLabelForIndex:function(t){return r[t].xValue}},_yScale:{getLabelForIndex:function(t){return r[t].value}},_chart:e};r.push(m)}}}}}var v=t.Interaction.modes.x(e,a,i);for(d=0;d<v.length;d++){var y=v[d];e.data.datasets[y._datasetIndex].interpolate||r.push(y)}return r}}(i.default),function(t,e){var a={line:{color:"#F66",width:1,dashPattern:[]},sync:{enabled:!0,group:1,suppressTooltips:!1},zoom:{enabled:!0,zoomboxBackgroundColor:"rgba(66,133,244,0.2)",zoomboxBorderColor:"#48F",zoomButtonText:"Reset Zoom",zoomButtonClass:"reset-zoom"},snap:{enabled:!1},callbacks:{beforeZoom:function(t,e){return!0},afterZoom:function(t,e){}}},i={id:"crosshair",afterInit:function(t){let e=Object.keys(t.config.options.scales).filter((function(e){return"x"===t.config.options.scales[e].axis}));if(0!==e.length){var i=t.config.options.scales[e[0]].type;if("linear"===i||"time"===i||"category"===i||"logarithmic"===i||"timeseries"===i)void 0===t.options.plugins.crosshair&&(t.options.plugins.crosshair=a),t.crosshair={enabled:!1,x:null,originalData:[],originalXRange:{},dragStarted:!1,dragStartX:null,dragEndX:null,suppressTooltips:!1,reset:function(){this.resetZoom(t,!1,!1)}.bind(this)},this.getOption(t,"sync","enabled")&&(t.crosshair.syncEventHandler=function(e){this.handleSyncEvent(t,e)}.bind(this),t.crosshair.resetZoomEventHandler=function(e){var a=this.getOption(t,"sync","group");e.chartId!==t.id&&e.syncGroup===a&&this.resetZoom(t,!0)}.bind(this),window.addEventListener("sync-event",t.crosshair.syncEventHandler),window.addEventListener("reset-zoom-event",t.crosshair.resetZoomEventHandler)),t.panZoom=this.panZoom.bind(this,t)}},destroy:function(t){this.getOption(t,"sync","enabled")&&(window.removeEventListener("sync-event",t.crosshair.syncEventHandler),window.removeEventListener("reset-zoom-event",t.crosshair.resetZoomEventHandler))},panZoom:function(t,e){if(0!==t.crosshair.originalData.length){var a=t.crosshair.end-t.crosshair.start,i=t.crosshair.min,r=t.crosshair.max;e<0?(t.crosshair.start=Math.max(t.crosshair.start+e,i),t.crosshair.end=t.crosshair.start===i?i+a:t.crosshair.end+e):(t.crosshair.end=Math.min(t.crosshair.end+e,t.crosshair.max),t.crosshair.start=t.crosshair.end===r?r-a:t.crosshair.start+e),this.doZoom(t,t.crosshair.start,t.crosshair.end)}},getOption:function(t,i,r){return e.valueOrDefault(t.options.plugins.crosshair[i]?t.options.plugins.crosshair[i][r]:void 0,a[i][r])},getXScale:function(t){return t.data.datasets.length?t.scales[t.getDatasetMeta(0).xAxisID]:null},getYScale:function(t){return t.scales[t.getDatasetMeta(0).yAxisID]},handleSyncEvent:function(t,e){var a=this.getOption(t,"sync","group");if(e.chartId!==t.id&&e.syncGroup===a){var i=this.getXScale(t);if(i){var r=void 0===e.original.event.native.buttons?e.original.event.native.which:e.original.event.native.buttons;"mouseup"===e.original.type&&(r=0);var o={type:e.original.event.type,chart:t,x:i.getPixelForValue(e.xValue),y:e.original.event.y,native:{buttons:r},stop:!0};t._eventHandler(o)}}},afterEvent:function(t,e){let a=Object.keys(t.config.options.scales).filter((function(e){return"x"===t.config.options.scales[e].axis}));if(0!==a.length){var i=t.config.options.scales[a[0]].type;if("linear"===i||"time"===i||"category"===i||"logarithmic"===i||"timeseries"===i){var r=this.getXScale(t);if(r){var o=void 0===e.event.native.buttons?e.event.native.which:e.event.native.buttons;"mouseup"===e.event.native.type&&(o=0);var n=this.getOption(t,"sync","enabled"),s=this.getOption(t,"sync","group");if(!e.event.stop&&n){var c=new CustomEvent("sync-event");c.chartId=t.id,c.syncGroup=s,c.original=e,c.xValue=r.getValueForPixel(e.event.x),window.dispatchEvent(c)}var l=this.getOption(t,"sync","suppressTooltips");if(t.crosshair.suppressTooltips=e.event.stop&&l,t.crosshair.enabled="mouseout"!==e.event.type&&e.event.x>r.getPixelForValue(r.min)&&e.event.x<r.getPixelForValue(r.max),!t.crosshair.enabled)return!0;var h=this.getOption(t,"zoom","enabled");if(1===o&&!t.crosshair.dragStarted&&h&&(t.crosshair.dragStartX=e.event.x,t.crosshair.dragStarted=!0),t.crosshair.dragStarted&&0===o){t.crosshair.dragStarted=!1;var d=r.getValueForPixel(t.crosshair.dragStartX),u=r.getValueForPixel(t.crosshair.x);Math.abs(t.crosshair.dragStartX-t.crosshair.x)>1&&this.doZoom(t,d,u),t.update()}t.crosshair.x=e.event.x,t.draw()}}}},afterDraw:function(t){if(t.crosshair.enabled)return t.crosshair.dragStarted?this.drawZoombox(t):(this.drawTraceLine(t),this.interpolateValues(t),this.drawTracePoints(t)),!0},beforeTooltipDraw:function(t){return!t.crosshair.dragStarted&&!t.crosshair.suppressTooltips},resetZoom:function(t){let e=Object.keys(t.config.options.scales).filter((function(e){return"x"===t.config.options.scales[e].axis}));if(0!==e.length){var a=t.config.options.scales[e[0]],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(r){for(var o=0;o<t.data.datasets.length;o++){var n=t.data.datasets[o];n.data=t.crosshair.originalData.shift(0)}var s="ticks";a.time&&(s="time"),t.crosshair.originalXRange.min?(a[s].min=t.crosshair.originalXRange.min,t.crosshair.originalXRange.min=null):delete a[s].min,t.crosshair.originalXRange.max?(a[s].max=t.crosshair.originalXRange.max,t.crosshair.originalXRange.max=null):delete a[s].max}t.crosshair.button&&t.crosshair.button.parentNode&&(t.crosshair.button.parentNode.removeChild(t.crosshair.button),t.crosshair.button=!1);var c=this.getOption(t,"sync","enabled");if(!i&&r&&c){var l=this.getOption(t,"sync","group"),h=new CustomEvent("reset-zoom-event");h.chartId=t.id,h.syncGroup=l,window.dispatchEvent(h)}if(r){var d=t.options.animation;t.options.animation=!1,t.update(),t.options.animation=d}}},doZoom:function(t,e,a){if(e>a){var i=e;e=a,a=i}var r=t.config.options.plugins.crosshair.callbacks;if(r&&"function"==typeof r.beforeZoom&&!r.beforeZoom(e,a))return!1;let o=Object.keys(t.config.options.scales).filter((function(e){return"x"===t.config.options.scales[e].axis}));if(0!==o.length){var n=t.config.options.scales[o[0]];if("time"===n.type?(n.time.min&&0===t.crosshair.originalData.length&&(t.crosshair.originalXRange.min=n.time.min),n.time.max&&0===t.crosshair.originalData.length&&(t.crosshair.originalXRange.max=n.time.max)):(n.ticks.min&&void 0===t.crosshair.originalData.length&&(t.crosshair.originalXRange.min=n.ticks.min),n.ticks.max&&void 0===t.crosshair.originalData.length&&(t.crosshair.originalXRange.max=n.ticks.max)),!t.crosshair.button){var s=document.createElement("button"),c=this.getOption(t,"zoom","zoomButtonText"),l=this.getOption(t,"zoom","zoomButtonClass"),h=document.createTextNode(c);s.appendChild(h),s.className=l,s.addEventListener("click",function(){this.resetZoom(t)}.bind(this)),t.canvas.parentNode.appendChild(s),t.crosshair.button=s}n.time?(n.time.min=e,n.time.max=a):(n.ticks.min=e,n.ticks.max=a);for(var d=0===t.crosshair.originalData.length,u=0;u<t.data.datasets.length;u++){var g=[],f=0,p=!1,x=!1;d&&(t.crosshair.originalData[u]=t.data.datasets[u].data);for(var m=t.crosshair.originalData[u],v=0;v<m.length;v++){var y=m[v],b=this.getRightValue(y,t);b>=e&&!p&&f>0&&(g.push(m[f-1]),p=!0),b>=e&&b<=a&&g.push(y),b>a&&!x&&f<m.length&&(g.push(y),x=!0),f+=1}t.data.datasets[u].data=g}if(t.crosshair.start=e,t.crosshair.end=a,d){var w=this.getXScale(t);t.crosshair.min=w.min,t.crosshair.max=w.max}t.update(),r&&"function"==typeof r.afterZoom&&r.afterZoom(e,a)}},drawZoombox:function(t){var e=this.getYScale(t),a=this.getOption(t,"zoom","zoomboxBorderColor"),i=this.getOption(t,"zoom","zoomboxBackgroundColor");t.ctx.beginPath(),t.ctx.rect(t.crosshair.dragStartX,e.getPixelForValue(e.max),t.crosshair.x-t.crosshair.dragStartX,e.getPixelForValue(e.min)-e.getPixelForValue(e.max)),t.ctx.lineWidth=1,t.ctx.strokeStyle=a,t.ctx.fillStyle=i,t.ctx.fill(),t.ctx.fillStyle="",t.ctx.stroke(),t.ctx.closePath()},drawTraceLine:function(t){var e=this.getYScale(t),a=this.getOption(t,"line","width"),i=this.getOption(t,"line","color"),r=this.getOption(t,"line","dashPattern"),o=this.getOption(t,"snap","enabled"),n=t.crosshair.x;o&&t.active.length&&(n=t.active[0]._view.x),t.ctx.beginPath(),t.ctx.setLineDash(r),t.ctx.moveTo(n,e.getPixelForValue(e.max)),t.ctx.lineWidth=a,t.ctx.strokeStyle=i,t.ctx.lineTo(n,e.getPixelForValue(e.min)),t.ctx.stroke(),t.ctx.setLineDash([])},drawTracePoints:function(t){for(var e=0;e<t.data.datasets.length;e++){var a=t.data.datasets[e],i=t.getDatasetMeta(e),r=t.scales[i.yAxisID];!i.hidden&&a.interpolate&&(t.ctx.beginPath(),t.ctx.arc(t.crosshair.x,r.getPixelForValue(a.interpolatedValue),3,0,2*Math.PI,!1),t.ctx.fillStyle="white",t.ctx.lineWidth=2,t.ctx.strokeStyle=a.borderColor,t.ctx.fill(),t.ctx.stroke())}},interpolateValues:function(t){for(var e=0;e<t.data.datasets.length;e++){var a=t.data.datasets[e],i=t.getDatasetMeta(e),r=t.scales[i.xAxisID].getValueForPixel(t.crosshair.x);if(!i.hidden&&a.interpolate){var o=a.data,n=o.findIndex((function(t){return t.x>=r})),s=o[n-1],c=o[n];if(t.data.datasets[e].steppedLine&&s)a.interpolatedValue=s.y;else if(s&&c){var l=(c.y-s.y)/(c.x-s.x);a.interpolatedValue=s.y+(r-s.x)*l}else a.interpolatedValue=NaN}}},getRightValue:function(t,e){if(null==t)return NaN;if(("number"==typeof t||t instanceof Number)&&!isFinite(t))return NaN;if(t){const a=e.config.options.position;if("top"===a||"bottom"===a)return this.getRightValue(t.y,e);if(void 0!==t.y&&void 0!==t.x)return this.getRightValue(t.x,e)}return t}};if(t.register)t.register(i);else{if(!t.Chart||!t.Chart.register)throw new Error("Cannot register crosshair plugin");t.Chart.register(i)}}(i.default,r.default||i.default.helpers)}));
