<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Use correct character set. -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <title>Map</title>
    <base target="_blank" />
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.76/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.76/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <script src="Chart/Chart.bundle.min.js"></script>
    <script src="Chart/chartjs-plugin-crosshair.min.js"></script>
    <script src="Chart/hammer.min.js"></script>
    <script src="Chart/chartjs-plugin-zoom.min.js"></script>
    <link href="Chart/Chart.min.css" rel="stylesheet">
    <link href="heightProfileView.css" rel="stylesheet">
    <style>

        html, body, #mapElement {
            width: 100vw;
            height: 100vh;
            margin: 0;
            padding: 0;
            overflow: hidden;
            position: absolute;
        }

        #chartContainer {
            opacity: 0.5;
            z-index: 10;
        }

        .cesium-infoBox {
            width: 80%;
            max-width: 80%;
        }
    </style>
</head>
<body style="margin: 0px">
    <script src="mapView3D.js"></script>
    <script src="heightProfileView.js"></script>

    <div style="position: absolute; top: 0px; margin: 10px; z-index: 100; width: 100vw">
        <select name="mapShadingMode" onChange="map.setShadingMode(this.value.toString())">
            <option value="Fixed10Am">Fixed at 10 am.</option>
            <option value="Fixed3Pm">Fixed at 3 pm.</option>
            <option value="CurrentTime">Current time</option>
            <option value="Ahead6Hours">Current time + 6 hours</option>
            <option value="None">No shading</option>
        </select>

        <select name="mapImageryType" onChange="map.setMapImageryType(this.value.toString())">
            <option value="OpenStreetMap">OpenStreetMap</option>
            <option value="BingMapsAerialWithLabels">Bing maps Aerial with labels</option>
            <option value="OpenTopoMap">OpenTopoMap</option>
        </select>

        <select name="mapOverlayType" onChange="map.setMapOverlayType(this.value.toString())">
            <option value="None">None</option>
            <option value="ThermalSkywaysKk7">kk7 thermal skyways</option>
            <option value="ContourLines">Contour lines</option>
            <option value="SlopeAndContourLines">Slope + contour lines</option>
            <option value="BlackMarble">NASA Black Marble 2017</option>
        </select>

        <button onclick="map.updateMyLocation({latitude: 47.666283, longitude: 11.886159, zoomToLocation: true})">Fly to my position</button>

        <button onclick="map.zoomToLocation({latitude: 47.6764385, longitude: 11.8710533})">Fly to summit</button>

        <button onclick="showFindResult()">Show find result</button>

        <button onclick="addTrack()">Add track</button>

        <button onclick="zoomToTrack()">Zoom to track</button>

        <button onclick="sampleTrackHeights()">Sample track heights</button>

        <button onclick="addOsmBuildingsLayer()">Add OSM Buildings layer</button>

        <button onclick="removeOsmBuildingsLayer()">Remove OSM Buildings layer</button>

        <button onclick="addTakeoffLocation()">Add Takeoff</button>
    </div>

    <div style="position: absolute" id="mapElement"></div>

    <div id="chartContainer" class="chart-and-toolbar-container chart-and-toolbar-container-bottom" style="display:none">
        <div class="chart-toolbar-container">
            <div id="chartButtonClose"
                 class="chart-toolbar-button"
                 onclick="javascript:map.heightProfileView.hide();">
                <img class="chart-toolbar-button-image" src="images/close.svg" />
            </div>

            <div id="chartButtonResetZoom"
                 class="chart-toolbar-button"
                 onclick="javascript:map.heightProfileView.resetZoom();">
                <img class="chart-toolbar-button-image" src="images/arrow-expand-horizontal.svg" />
            </div>

            <div id="chartButtonModeHover"
                 class="chart-toolbar-button chart-toolbar-button-disabled"
                 style="margin-left:0px;"
                 onclick="javascript:map.heightProfileView.setModeHover();">
                <img class="chart-toolbar-button-image" src="images/gesture-tap.svg" />
            </div>

            <div id="chartButtonModeZoomAndPan"
                 class="chart-toolbar-button"
                 style="margin-right:0px;"
                 onclick="javascript:map.heightProfileView.setModeZoomAndPan();">
                <img class="chart-toolbar-button-image" src="images/gesture-spread.svg" />
            </div>
        </div>
        <div>
            <canvas id="chartElement" class="chart-canvas"></canvas>
        </div>
    </div>

    <script type="text/javascript">

        // function used to call to C#
        function callAction(funcName, params) {
            console.log("callback://" + funcName + "/" + JSON.stringify(params));
        }

        map = new MapView({
            id: 'mapElement',
            initialCenterPoint: { latitude: 47.6764385, longitude: 11.8710533 },
            initialZoomLevel: 14
        });

        map.setMapImageryType('OpenStreetMap');
        map.setMapOverlayType('None');
        map.setShadingMode('Ahead6Hours');

        map.addLocationList([
            { "id": "{cc8fa282-10fb-4bab-8af2-0a31f5d528a3}", "name": "Brecherspitz", "description": "Herrliche Aussicht über die drei Seen Schliersee im Norden, Tegernsee im Westen und den Spitzingsee im Süden.", "type": "Summit", "latitude": 47.6764385, "longitude": 11.8710533, "elevation": 1685 },
            { "id": "{d5012732-c371-4b46-9b28-a0aa7a3e47c7}", "name": "Jägerkamp", "description": "Gipfel in den Schlierseer Bergen, mit Ausblick auf Schliersee und die umliegenden Berge.", "type": "Summit", "latitude": 47.673511, "longitude": 11.9060494, "elevation": 1746 },
            { "id": "{2121170e-2f6f-49bd-8f57-b8d64d8b38bb}", "name": "Ankel-Alm", "description": "Privat bewirtschaftete Alm; Montag Ruhetag", "type": "AlpineHut", "latitude": 47.6838571, "longitude": 11.8687695, "elevation": 1311 },
            { "id": "{a963bac3-c573-4498-80d3-447ddeb9494a}", "name": "Schönfeldhütte", "description": "Alpenvereinshütte der Sektion München des DAV", "type": "AlpineHut", "latitude": 47.66508, "longitude": 11.90612, "elevation": 1410 },
            { "id": "{807a72a2-34b9-486d-9f5a-24b404a797ae}", "name": "Spitzingsattel", "description": "Sattel auf halbem Wege zwischen Schliersee und Spitzingsee", "type": "Pass", "latitude": 47.672138, "longitude": 11.8862728, "elevation": 1129 },
            { "id": "{ec0a1a47-b67e-42f1-b6d2-322d259ca729}", "name": "Bahnhof Neuhaus (Schliersee)", "description": "Anschlussmöglichkeiten zum RBO Bus 9562 zum Spitzingsattel", "type": "PublicTransportTrain", "latitude": 47.70599, "longitude": 11.87451, "elevation": 809 },
            { "id": "{4064d1f0-a476-4fe8-973f-f784cae39790}", "name": "RBO Bus 9562 Bushaltestelle Spitzingsattel", "description": "Haltestelle am Spitzingsattel. Abfahrtszeiten Richtung Schliersee: 8:42, 11:15, 15:31, 18:02.", "type": "PublicTransportBus", "latitude": 47.672138, "longitude": 11.8862728, "elevation": 1129 }
        ]);

        setTimeout(function () {
            map.updateMyLocation({
                latitude: 47.666283,
                longitude: 11.886159,
                altitude: 1084,
                displayLatitude: '47°39\'58.6"N',
                displayLongitude: '11°53\'10.2"E',
                displayTimestamp: '2018-01-07 12:01:54',
                zoomTo: false
            });
        }, 2000);

        showFindResult = function () {
            map.showFindResult({
                name: 'Bodenschneid',
                description: 'Beschreibung',
                latitude: 47.6717531,
                longitude: 11.8381005,
                altitude: 1667,
                displayLatitude: '47°40\'18.3"N',
                displayLongitude: '11°50\'17.2"E'
            });
        }

        addTrack = function () {
            theTrack = {
                id: 'crossingthealps2018',
                name: 'Crossing the Alps 2018',
                isFlightTrack: false,
                listOfTrackPoints: [12.352277, 47.754076, 0, 12.432716, 47.630431, 0, 12.29676, 47.285013, 0, 12.183008, 47.090525, 0, 11.958434, 46.738669, 0, 11.787137, 46.296141, 0, 11.904684, 46.017666, 0],
                color: "FF0000"
            };
            map.addTrack(theTrack);
        }

        zoomToTrack = function () {
            map.zoomToTrack(theTrack.id);
        }

        sampleTrackHeights = function () {
            map.showTrackHeightProfile(theTrack.id);

            map.onSampledTrackHeights = function (listOfTrackPointHeights) {
                theTrack.groundHeightProfile = listOfTrackPointHeights;

                map.heightProfileView.addGroundProfile(theTrack.groundHeightProfile);
            };

            map.sampleTrackHeights(theTrack);
        }

        addOsmBuildingsLayer = function () {
            var theLayer = {
                id: 'osmBuildingsLayer',
                name: 'Cesium OSM Buildings',
                type: 'OsmBuildingsLayer',
                isVisible: true
            };
            map.addLayer(theLayer);
        }

        removeOsmBuildingsLayer = function () {
            map.removeLayer('osmBuildingsLayer');
        }

        addTakeoffLocation = function () {
            var theLocation = {
                "id": "wheretofly-path-nagelspitz-start",
                "name": "SP Jägerkamp/Nagelspitz (NW-WNW, E)",
                "description": "",
                "type": "FlyingTakeoff",
                "latitude": 47.679201,
                "longitude": 11.90403,
                "altitude": 1612.0,
                "takeoffDirections": 1 + 16 + 256 + 1024 + 4096, // N,E,S,SW,W
                "isPlanTourLocation": false
            };
            map.addLocationList([theLocation]);
            map.zoomToLocation(theLocation);
        }

    </script>

</body>
</html>
