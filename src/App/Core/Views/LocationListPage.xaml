<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:android="clr-namespace:Xamarin.Forms.PlatformConfiguration.AndroidSpecific;assembly=Xamarin.Forms.Core"
             xmlns:controls="clr-namespace:WhereToFly.App.Core.Controls"
             xmlns:local="clr-namespace:WhereToFly.App.Core"
             x:Class="WhereToFly.App.Core.Views.LocationListPage">
    <StackLayout Orientation="Vertical" VerticalOptions="FillAndExpand" HorizontalOptions="FillAndExpand">

        <!-- Filter controls -->
        <StackLayout Orientation="Horizontal">
            <Label Text="Filter" VerticalTextAlignment="Center" />
            <Entry Text="{Binding Path=FilterText, Mode=TwoWay}"
                   Placeholder="Type here to filter"
                   HorizontalOptions="FillAndExpand"
                   AutomationId="FilterText" />
        </StackLayout>

        <!-- activity indicator to show while refreshing list -->
        <StackLayout Padding="4" BackgroundColor="LightBlue"
                     HeightRequest="32"
                     HorizontalOptions="FillAndExpand"
                     Orientation="Horizontal"
                     IsVisible="{Binding IsListRefreshActive, Mode=OneWay}" >
            <ActivityIndicator IsRunning="True" WidthRequest="20" />
            <Label Text="List is being refreshed" VerticalTextAlignment="Center" FontSize="Medium" />
        </StackLayout>

        <!-- Message to show when all locations were filtered out -->
        <StackLayout Padding="8" BackgroundColor="Yellow"
                     HorizontalOptions="FillAndExpand"
                     IsVisible="{Binding Path=AreAllLocationsFilteredOut, Mode=OneWay}">
            <Label Text="All locations filtered out" FontSize="Medium"
                   AutomationId="AllFilteredOutLabel" />
        </StackLayout>

        <!-- Location list -->
        <ListView x:Name="locationsListView"
                  ItemsSource="{Binding Path=LocationList, Mode=OneWay}"
                  RowHeight="85"
                  ItemTapped="OnItemTapped_LocationsListView"
                  IsPullToRefreshEnabled="False"
                  android:ListView.IsFastScrollEnabled="true"
                  CachingStrategy="RecycleElement"
                  SeparatorVisibility="None"
                  AutomationId="LocationList">

            <ListView.ItemTemplate>
                <DataTemplate>
                    <!-- Template for a single view cell -->
                    <ViewCell Height="85">
                        <ViewCell.View>
                            <Grid BackgroundColor="#efefef" Margin="8,4">
                                <Grid.RowDefinitions>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition/>
                                </Grid.ColumnDefinitions>

                                <!-- Type image -->
                                <controls:SvgImage Source="{Binding TypeImageSource, Mode=OneWay}"
                                                   WidthRequest="32" HeightRequest="32" Margin="4,0,0,0"
                                                   HorizontalOptions="Start" VerticalOptions="Center"
                                                   Grid.Column="0" Grid.RowSpan="3"/>

                                <!-- Details -->
                                <Label Text="{Binding Name}"
                                       Style="{DynamicResource ListItemTextStyle}"
                                       FontSize="Medium"
                                       LineBreakMode="TailTruncation"
                                       Grid.Column="1" Grid.Row="0" />
                                <Label Text="{Binding DetailInfos}"
                                       Style="{DynamicResource ListItemDetailTextStyle}"
                                       FontSize="Small"
                                       LineBreakMode="TailTruncation"
                                       Grid.Column="1" Grid.Row="1" />
                                <Label Text="{Binding Description}"
                                       Style="{DynamicResource ListItemDetailTextStyle}"
                                       FontSize="Small"
                                       LineBreakMode="TailTruncation"
                                       Grid.Column="1" Grid.Row="2" />
                            </Grid>
                        </ViewCell.View>
                        <ViewCell.ContextActions>
                            <MenuItem Text="Show Details"
                                      Icon="information_outline.xml"
                                      Command="{Binding ShowDetailsLocationContextAction}" />
                            <MenuItem Text="Zoom to"
                                      Icon="magnify_plus_outline.xml"
                                      Command="{Binding ZoomToLocationContextAction}" />
                            <MenuItem Text="Delete" IsDestructive="True"
                                      Icon="delete.xml"
                                      Command="{Binding DeleteLocationContextAction}" />
                        </ViewCell.ContextActions>
                    </ViewCell>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

    </StackLayout>
</ContentPage>
